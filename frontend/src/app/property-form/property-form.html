<header class="topbar-blue">
  <h2 class="logo-text" (click)="goBackHome()" style="cursor: pointer;" title="Voltar ao In√≠cio">Roomie</h2>
  <div class="header-buttons">
    <button class="profile-btn" (click)="goToProfile()">Meu Perfil</button>
    <button class="profile-btn" (click)="onLogout()">Sair</button>
  </div>
</header>

<div class="container">
  <h2>Cadastrar Im√≥vel</h2>

  <form [formGroup]="propertyForm" (ngSubmit)="onSubmit()">

    <div class="form-group">
      <label for="title">T√≠tulo do An√∫ncio</label>
      <input id="title" type="text" formControlName="title" class="form-control" placeholder="Ex: Quarto individual perto da UFAPE">
      <div *ngIf="propertyForm.get('title')?.invalid && propertyForm.get('title')?.touched" class="error">
        O t√≠tulo √© obrigat√≥rio e deve ter entre 5 e 100 caracteres.
      </div>
    </div>

    <div class="form-group">
      <label for="type">Tipo de Im√≥vel</label>
      <select id="type" formControlName="type" class="form-control">
        <option [ngValue]="null" disabled>Selecione...</option>
        <option *ngFor="let type of propertyTypes" [value]="type">
          {{ getLabelForType(type) }}
        </option>
      </select>
      <div *ngIf="propertyForm.get('type')?.invalid && propertyForm.get('type')?.touched" class="error">
        Selecione um tipo.
      </div>
    </div>

    <div class="form-group">
      <label for="price">Pre√ßo (R$)</label>
      <input id="price" type="number" formControlName="price" class="form-control" placeholder="0.00">
      <div *ngIf="propertyForm.get('price')?.invalid && propertyForm.get('price')?.touched" class="error">
        O pre√ßo √© obrigat√≥rio e deve ser positivo.
      </div>
    </div>

    <div class="form-group">
      <label for="vacancies">N¬∫ de Quartos / Vagas</label>
      <input id="vacancies" type="number" formControlName="availableVacancies" class="form-control">
      <div *ngIf="propertyForm.get('availableVacancies')?.invalid && propertyForm.get('availableVacancies')?.touched" class="error">
        Informe pelo menos 1 vaga.
      </div>
    </div>

    <div class="form-group">
      <label for="description">Descri√ß√£o</label>
      <textarea id="description" formControlName="description" class="form-control" rows="3"></textarea>
    </div>

    <hr>
    <h3>Endere√ßo</h3>

    <div formGroupName="address" class="address-group">

      <div class="form-group">
        <label for="street">Rua</label>
        <input id="street" type="text" formControlName="street" class="form-control">
        <div *ngIf="propertyForm.get('address.street')?.invalid && propertyForm.get('address.street')?.touched" class="error">
          A rua √© obrigat√≥ria.
        </div>
      </div>

      <div class="form-group">
        <label for="number">N√∫mero</label>
        <input id="number" type="text" formControlName="number" class="form-control">
        <div *ngIf="propertyForm.get('address.number')?.invalid && propertyForm.get('address.number')?.touched" class="error">
          O n√∫mero √© obrigat√≥rio.
        </div>
      </div>

      <div class="form-group">
        <label for="district">Bairro</label>
        <input id="district" type="text" formControlName="district" class="form-control">
        <div *ngIf="propertyForm.get('address.district')?.invalid && propertyForm.get('address.district')?.touched" class="error">
          O bairro √© obrigat√≥rio.
        </div>
      </div>

      <div class="form-group">
        <label for="city">Cidade</label>
        <input id="city" type="text" formControlName="city" class="form-control">
        <div *ngIf="propertyForm.get('address.city')?.invalid && propertyForm.get('address.city')?.touched" class="error">
          A cidade √© obrigat√≥ria.
        </div>
      </div>

      <div class="form-group">
        <label for="state">Estado</label>
        <input id="state" type="text" formControlName="state" class="form-control" placeholder="Ex: PE">
        <div *ngIf="propertyForm.get('address.state')?.invalid && propertyForm.get('address.state')?.touched" class="error">
          O estado √© obrigat√≥rio.
        </div>
      </div>

      <div class="form-group">
        <label for="cep">CEP</label>
        <input id="cep" type="text" formControlName="cep" class="form-control" placeholder="00000-000">
        <div *ngIf="propertyForm.get('address.cep')?.invalid && propertyForm.get('address.cep')?.touched" class="error">
          O CEP √© inv√°lido.
        </div>
      </div>
    </div>

    <hr>
    <h3>Fotos do Im√≥vel</h3>

    <div class="image-upload-section">
      <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
        Adicione fotos para destacar seu an√∫ncio.
      </p>

      <button type="button" class="btn-image" (click)="toggleImageUpload()">
          üì∏ Inserir Imagens
      </button>

      <div *ngIf="showImageUpload" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px dashed #ccc;">

        <label for="fileInput" style="cursor: pointer; display: inline-block; padding: 8px 15px; background-color: #007bff; color: white; border-radius: 4px; font-weight: bold; margin-bottom: 15px;">
          üìÇ Escolher Arquivos
        </label>
        <input id="fileInput" type="file" multiple accept="image/*" (change)="onFileSelected($event)" style="display: none;">

        <p style="font-size: 13px; color: #666; margin-top: -5px;">Pode selecionar m√∫ltiplas imagens.</p>

        <div *ngIf="imagePreviews.length > 0" style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
          <div *ngFor="let preview of imagePreviews; let i = index" style="position: relative;">

            <img [src]="preview" alt="Preview" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">

            <button type="button" (click)="removeImage(i)" title="Remover" style="position: absolute; top: -8px; right: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
              ‚úï
            </button>

          </div>
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="propertyForm.invalid || isSubmitting">
      {{ isSubmitting ? 'Salvando...' : 'Salvar Im√≥vel' }}
    </button>
  </form>
</div>
