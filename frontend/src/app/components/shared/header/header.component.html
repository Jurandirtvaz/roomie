<header class="topbar-blue">
  <h2 (click)="onLogoClick()" class="logo-text" title="Início">Roomie</h2>

  <div class="header-buttons">
    <button (click)="goToCreateProperty()" *ngIf="showCreateProperty" class="outline-btn">
      + Cadastrar Imóvel
    </button>

    <div *ngIf="user$ | async as user" class="user-menu-wrapper">
      <button
        (click)="toggleMenu()"
        (keydown)="onButtonKeydown($event)"
        [attr.aria-expanded]="isMenuOpen"
        [attr.aria-label]="'Menu do usuário ' + user.name"
        aria-controls="user-dropdown-menu"
        aria-haspopup="true"
        class="user-button"
      >
        <span aria-hidden="true" class="user-initials">{{ getInitials(user.name) }}</span>
        <span aria-hidden="true" class="arrow-down">▾</span>
      </button>

      <div
        (keydown)="onMenuKeydown($event)"
        *ngIf="isMenuOpen"
        aria-label="Menu do usuário"
        class="user-dropdown"
        id="user-dropdown-menu"
        role="menu"
      >
        <!-- Cabeçalho com nome e e-mail -->
        <div aria-hidden="true" class="dropdown-user-info">
          <div class="dropdown-avatar">{{ getInitials(user.name) }}</div>
          <div class="dropdown-user-text">
            <strong>{{ user.name }}</strong>
            <span>{{ user.email }}</span>
          </div>
        </div>

        <hr aria-hidden="true">

        <ul role="none">
          <li (click)="goToProfile()" (keydown.enter)="goToProfile()" (keydown.space)="goToProfile()" role="menuitem"
              tabindex="0">
            <span aria-hidden="true" class="material-icons">person_outline</span>
            Minha conta
          </li>

          <li role="menuitem" tabindex="0">
            <span aria-hidden="true" class="material-icons">favorite_border</span>
            Favoritos
          </li>

          <li (click)="goToCreateProperty()" (keydown.enter)="goToCreateProperty()" (keydown.space)="goToCreateProperty()" role="menuitem"
              tabindex="0">
            <span aria-hidden="true" class="material-icons">add_circle_outline</span>
            Cadastrar Imóvel
          </li>

          <li (click)="goToMyProperties()" (keydown.enter)="goToMyProperties()" (keydown.space)="goToMyProperties()" role="menuitem"
              tabindex="0">
            <span aria-hidden="true" class="material-icons">home_work</span>
            Meus Imóveis
          </li>

          <!-- Visível apenas para não-administradores -->
          <li (click)="goToStudentProfile()" (keydown.enter)="goToStudentProfile()" (keydown.space)="goToStudentProfile()" *ngIf="user.role !== 'ADMIN'"
              role="menuitem" tabindex="0">
            <span aria-hidden="true" class="material-icons">school</span>
            Minha Instituição
          </li>

          <hr aria-hidden="true" role="none">

          <li (click)="onLogout()" (keydown.enter)="onLogout()" (keydown.space)="onLogout()" class="logout-item" role="menuitem"
              tabindex="0">
            <span aria-hidden="true" class="material-icons">logout</span>
            Sair
          </li>
        </ul>

      </div>
    </div>
  </div>
</header>
